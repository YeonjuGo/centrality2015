
#include "TFile.h"
#include "TTree.h"
#include <iostream>
using namespace std;

void makeCentrality(){



   //   TFile* infData = TFile::Open("root://eoscms.cern.ch//eos/cms/store/group/phys_heavyions/velicanu/forest/Run2015E/HIExpressPhysics/Merged/HiForestStreamer_Run262314-262315.root");
   TFile* infData = TFile::Open("/data/velicanu/store/group/phys_heavyions/velicanu/forest/Run2015E/HIExpressPhysics/Merged/HiForest_Streamer_run262315.root");

   float bounds[200] = {
      0, 8.79414, 9.34528, 9.91401, 10.5464, 11.1385, 11.7077, 12.3595, 12.9831, 13.6738, 14.345, 15.21, 15.9191, 16.7937, 17.6538, 18.5561, 19.5529, 20.4326, 21.4537, 22.6266, 23.8375, 25.085, 26.4869, 27.814, 29.1288, 30.5229, 32.0477, 33.3984, 34.7406, 36.1956, 37.9677, 39.617, 41.5297, 43.304, 45.2061, 47.05, 49.3473, 51.5982, 53.9095, 56.5703, 59.2129, 61.8244, 64.8331, 67.7863, 70.5047, 73.8036, 77.0984, 80.2255, 83.9154, 87.7603, 91.2082, 94.5404, 98.5671, 102.42, 106.649, 110.926, 115.315, 120.12, 124.63, 129.737, 134.639, 139.987, 145.533, 151.582, 157.108, 163.026, 169.452, 175.381, 182.409, 188.887, 195.946, 202.176, 209.055, 216.566, 222.964, 230.215, 239.191, 247.92, 256.858, 265.632, 275.775, 285.619, 294.931, 304.033, 314.721, 326.604, 338.35, 350.286, 361.686, 372.824, 382.961, 394.634, 405.853, 417.848, 428.836, 444.202, 458.04, 471.259, 484.261, 498.948, 513.108, 528.726, 542.764, 559.877, 576.1, 591.994, 609.228, 624.038, 641.297, 660.563, 678.797, 696.538, 716.873, 733.619, 752.647, 770.438, 792.369, 815.018, 832.646, 853.891, 876.953, 900.856, 921.653, 945.137, 969.459, 992.555, 1017.78, 1041.49, 1065.87, 1090.24, 1117.23, 1144.07, 1172.45, 1204, 1234.46, 1261.07, 1289.85, 1318.84, 1346.74, 1376.39, 1406.96, 1440.27, 1467.3, 1497.73, 1531.28, 1560.87, 1595, 1628.99, 1661.92, 1699.65, 1739.55, 1775.73, 1815, 1853.41, 1894.73, 1930.33, 1970.49, 2006.37, 2049.38, 2088.48, 2124.62, 2164.98, 2214.54, 2260.21, 2314.06, 2363.86, 2414.44, 2456.08, 2506.96, 2555.92, 2606.81, 2662.22, 2706.76, 2763.24, 2815.67, 2876.7, 2935.69, 2994.78, 3056.93, 3119.04, 3189.75, 3258.87, 3323.31, 3381.99, 3453.8, 3534.62, 3600.45, 3674.79, 3731.62, 3812.67, 3902.56, 3978.18, 4050.81, 4127.39, 4212.27, 4306.82, 4408.48, 4499.04, 4612.74, 4740.21
   };

   TTree* tref = (TTree*)infData->Get("hiEvtAnalyzer/HiTree");
   TFile* outf = new TFile("friendly_centrality_HiForest_Streamer_run262315.root","recreate");

   float hf;
   tref->SetBranchAddress("hiHF",&hf);

   int newbin;

   TTree* t = new TTree("anaCentrality","analysis level centrality");
   t->Branch("anaBin",&newbin,"anaBin/I");

   int N = tref->GetEntries();
   for(int i = 0; i < N; ++i){
      tref->GetEntry(i);
      if(i % 100 == 0) cout<<"processing event : "<<i<<endl;
      newbin = 199;
      for(int b = 0; b < 200; ++b){
	 if(hf >= bounds[199-b]){
	    newbin = b;
	    break;	    
	 }

      }

      t->Fill();
   }


   t->Write();
   outf->Write();

}


